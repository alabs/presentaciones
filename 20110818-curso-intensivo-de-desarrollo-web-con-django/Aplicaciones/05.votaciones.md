!SLIDE subsection transition=scrollLeft

# django-ratings

!SLIDE transition=scrollLeft

# django-ratings

## [https://github.com/dcramer/django-ratings](https://github.com/dcramer/django-ratings)

!SLIDE transition=scrollLeft

# django-ratings

## Instalación

### settings.py

    @@@python
    INSTALLED_APPS = (
        (...)
        'django-ratings',
    )

!SLIDE commandline transition=scrollLeft

# django-ratings

## Instalación

    $ python manage syncdb

!SLIDE smaller transition=scrollLeft

# django-ratings

## Instalación

### models.py: 

    @@@python
    from djangoratings.fields import RatingField
    from django.db import models

    class Serie(models.Model):
        rating = RatingField(
            range=5,
            can_change_vote=True,
            allow_delete=True,
            help_text=_('puntuacion de estrellas')
        )

!SLIDE transition=scrollLeft

# django-ratings

## Instalación

### migración

!SLIDE smaller transition=scrollLeft

# url.py 

    @@@python

    url(r'^serie/(?P<serie_slug>[-\w]+)/rate/$', 'serie.ajax.rating_serie', name="rating_serie"),


!SLIDE smaller transition=scrollLeft

# En el views.py  (en este caso apps/serie/ajax.py)

    @@@python
    from django.contrib.auth.decorators import login_required
    from djangoratings.views import InvalidRating
    from serie import models as m

    @login_required
    def rating_serie(request, serie_slug):
        ''' Tratamiento de ratings para series '''
        if request.method == 'POST' and request.is_ajax():
            serie = m.Serie.objects.get(slug_name=serie_slug)
            if request.POST['rating']:
                try:
                    serie.rating.add( score=request.POST['rating'], user=request.user,
                        ip_address=request.META['REMOTE_ADDR']
                    )
                    response = 'Ok'
                except InvalidRating:
                    response = 'Error'
                return HttpResponse(
                    simplejson.dumps(response),
                    mimetype='application/json'
                )
        else:
            return HttpResponseForbidden('Error en la peticion AJAX')



!SLIDE transition=scrollLeft

# Javascript 

    @@@javascript
    // Rating de estrellas, se envia el rating por post a /serie/nombre
    $('.ratingstar').rating({
        callback: function (value, link) {
            var url = window.location.pathname + 'rate/';
            if (!value) {
              var value = 0;
            }
            $.post(url, {
                'rating': value,
                'csrfmiddlewaretoken': getCookie('csrftoken')
            }, function (data) {
                disc_rat_data(data);
            });
        }
    }); 

!SLIDE transition=scrollLeft

# django-voting
